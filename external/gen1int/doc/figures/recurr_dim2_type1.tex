\documentclass{article}

\usepackage[latin1]{inputenc}
\usepackage{tikz}

%\usepackage[textwidth=1cm,textheight=22cm]{geometry}

\setlength{\pdfpagewidth}{16.7cm}
\setlength{\pdfpageheight}{25.3cm}
%\setlength{\pdfvorigin}{25.4mm}

\setlength{\textwidth}{16.7cm}
\setlength{\textheight}{25.3cm}
%\setlength{\evensidemargin}{-2.7cm}
\setlength{\oddsidemargin}{-2.95cm}
\setlength{\topmargin}{-4.5cm}
\setlength{\headheight}{2cm}
\setlength{\headsep}{0cm}

\usetikzlibrary{shapes,arrows,shapes.geometric,calc,patterns}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{color}

\begin{document}
\pagestyle{empty}

\tikzstyle{block}=[color=black, rectangle, draw, sharp corners, very thin, node distance=0mm]

\tikzstyle{arrow}=[draw, very thick, -latex']

\begin{tikzpicture}[scale=1, auto]

% sub-recurrence relations: type 1
\node at (145mm,176mm) %
  {$\{\boldsymbol{i}\mathrm{+}\boldsymbol{e}_{\xi},\boldsymbol{j}\}'\Leftarrow %
    \{\boldsymbol{i},\boldsymbol{j}\mathrm{+}\boldsymbol{e}_{\xi}\}\text{ and/or }\boldsymbol{i}_{\xi} %
    \text{ and/or }\boldsymbol{j}_{\xi}$};
%
\node[block, minimum width=60mm, minimum height=36mm](sub-df) at (169mm,92mm){};
% dxx (x direction)
\fill[red!40](139mm,108mm) rectangle (157mm,110mm);
\fill[red!40](163mm,108mm) rectangle (175mm,110mm);
\fill[red!40](181mm,108mm) rectangle (187mm,110mm);
% dxx (y direction)
\fill[blue!40](145mm,106mm) rectangle (163mm,108mm);
\fill[blue!40](169mm,106mm) rectangle (181mm,108mm);
\fill[blue!40](187mm,106mm) rectangle (193mm,108mm);
% dxy (y direction)
\fill[blue!40](145mm,101mm) rectangle (163mm,104mm);
\fill[blue!40](169mm,101mm) rectangle (181mm,104mm);
\fill[blue!40](187mm,101mm) rectangle (193mm,104mm);
% dyy (y direction)
\fill[blue!40](145mm,95mm) rectangle (163mm,98mm);
\fill[blue!40](169mm,95mm) rectangle (181mm,98mm);
\fill[blue!40](187mm,95mm) rectangle (193mm,98mm);
% dxx (z direction)
\fill[green!40](163mm,104mm) rectangle (199mm,106mm);
\draw[very thin, dashed](139mm,104mm)--(199mm,104mm);
% dxy (z direction)
\fill[green!40](163mm,98mm) rectangle (199mm,101mm);
\draw[very thin, dashed](139mm,98mm)--(199mm,98mm);
% dyy (z direction)
\fill[green!40](163mm,92mm) rectangle (199mm,95mm);
\draw[very thin, dashed](139mm,92mm)--(199mm,92mm);
% others (z direction)
\fill[green!40](163mm,74mm) rectangle (199mm,92mm);
\draw[very thin, dashed](139mm,86mm)--(199mm,86mm);
\draw[very thin, dashed](139mm,80mm)--(199mm,80mm);
%
\draw[very thin, dashed](145mm,110mm)--(145mm,74mm);
\draw[very thin, dashed](151mm,110mm)--(151mm,74mm);
\draw[very thin, dashed](157mm,110mm)--(157mm,74mm);
\draw[very thin, dashed](163mm,110mm)--(163mm,74mm);
\draw[very thin, dashed](169mm,110mm)--(169mm,74mm);
\draw[very thin, dashed](175mm,110mm)--(175mm,74mm);
\draw[very thin, dashed](181mm,110mm)--(181mm,74mm);
\draw[very thin, dashed](187mm,110mm)--(187mm,74mm);
\draw[very thin, dashed](193mm,110mm)--(193mm,74mm);
%
\node at (142mm,72mm) {$\scriptstyle f_{xxx}$};
\node at (148mm,72mm) {$\scriptstyle f_{xxy}$};
\node at (154mm,72mm) {$\scriptstyle f_{xyy}$};
\node at (160mm,72mm) {$\scriptstyle f_{yyy}$};
\node at (166mm,72mm) {$\scriptstyle f_{xxz}$};
\node at (172mm,72mm) {$\scriptstyle f_{xyz}$};
\node at (178mm,72mm) {$\scriptstyle f_{yyz}$};
\node at (184mm,72mm) {$\scriptstyle f_{xzz}$};
\node at (190mm,72mm) {$\scriptstyle f_{yzz}$};
\node at (196mm,72mm) {$\scriptstyle f_{zzz}$};
\node at (202mm,107mm) {$d_{xx}$};
\node at (202mm,101mm) {$d_{xy}$};
\node at (202mm,95mm) {$d_{yy}$};
\node at (202mm,89mm) {$d_{xz}$};
\node at (202mm,83mm) {$d_{yz}$};
\node at (202mm,77mm) {$d_{zz}$};
%
\node[block, minimum width=36mm, minimum height=60mm](sub-fd) at (121mm,140mm){};
% from x direction
\fill[red!40](103mm,164mm) rectangle (139mm,170mm);
\draw[very thin, dashed](103mm,164mm)--(139mm,164mm);
% from y direction
\fill[blue!40](103mm,146mm) rectangle (139mm,164mm);
\draw[very thin, dashed](103mm,158mm)--(139mm,158mm);
\draw[very thin, dashed](103mm,152mm)--(139mm,152mm);
% from z direction
\fill[green!40](103mm,110mm) rectangle (139mm,146mm);
\draw[very thin, dashed](103mm,146mm)--(139mm,146mm);
\draw[very thin, dashed](103mm,140mm)--(139mm,140mm);
\draw[very thin, dashed](103mm,134mm)--(139mm,134mm);
\draw[very thin, dashed](103mm,128mm)--(139mm,128mm);
\draw[very thin, dashed](103mm,122mm)--(139mm,122mm);
\draw[very thin, dashed](103mm,116mm)--(139mm,116mm);
\node at (106mm,108mm) {$\scriptstyle d_{xx}$};
\node at (112mm,108mm) {$\scriptstyle d_{xy}$};
\node at (118mm,108mm) {$\scriptstyle d_{yy}$};
\node at (124mm,108mm) {$\scriptstyle d_{xz}$};
\node at (130mm,108mm) {$\scriptstyle d_{yz}$};
\node at (136mm,108mm) {$\scriptstyle d_{zz}$};
\node at (99mm,167mm) {$f_{xxx}$};
\node at (99mm,161mm) {$f_{xxy}$};
\node at (99mm,155mm) {$f_{xyy}$};
\node at (99mm,149mm) {$f_{yyy}$};
\node at (99mm,143mm) {$f_{xxz}$};
\node at (99mm,137mm) {$f_{xyz}$};
\node at (99mm,131mm) {$f_{yyz}$};
\node at (99mm,125mm) {$f_{xzz}$};
\node at (99mm,119mm) {$f_{yzz}$};
\node at (99mm,113mm) {$f_{zzz}$};
%
\draw[very thin, dashed](109mm,170mm)--(109mm,110mm);
\draw[very thin, dashed](115mm,170mm)--(115mm,110mm);
\draw[very thin, dashed](121mm,170mm)--(121mm,110mm);
\draw[very thin, dashed](127mm,170mm)--(127mm,110mm);
\draw[very thin, dashed](133mm,170mm)--(133mm,110mm);
%
% illustration of recurrence relations
%
% second order
\node[block, color=red, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dxx-x) at (185mm,164.5mm) {$d_{xx}$};
\node[block, color=blue, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dxx-y) at (185mm,160mm) {$d_{xx}$};
\node[block, color=blue, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dxy-y) at (185mm,155.3mm) {$d_{xy}$};
\node[block, color=blue, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dyy-y) at (185mm,150.4mm) {$d_{yy}$};
\node[block, color=green, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dxx-z) at (185mm,145.7mm) {$d_{xx}$};
\node[block, color=green, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dxy-z) at (185mm,141mm) {$d_{xy}$};
\node[block, color=green, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dyy-z) at (185mm,136mm) {$d_{yy}$};
\node[block, color=green, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dxz) at (185mm,131.3mm) {$d_{xz}$};
\node[block, color=green, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dyz) at (185mm,126.6mm) {$d_{yz}$};
\node[block, color=green, text width=5mm, inner sep=0.5mm, text centered, text height=0.5mm](dzz) at (185mm,121.9mm) {$d_{zz}$};
% third order
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=30mm, left of=dxx-z](fxxz){$f_{xxz}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=4.7mm, above of=fxxz](fyyy){$f_{yyy}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=5mm, above of=fyyy](fxyy){$f_{xyy}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=5mm, above of=fxyy](fxxy){$f_{xxy}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=4.7mm, above of=fxxy](fxxx){$f_{xxx}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=4.7mm, below of=fxxz](fxyz){$f_{xyz}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=5mm, below of=fxyz](fyyz){$f_{yyz}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=4.7mm, below of=fyyz](fxzz){$f_{xzz}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=4.7mm, below of=fxzz](fyzz){$f_{yzz}$};
\node[block, text width=7mm, inner sep=0.5mm, text centered, text height=0.5mm, node distance=4.7mm, below of=fyzz](fzzz){$f_{zzz}$};
%
\path[arrow, color=red, dotted](dxx-x)--node{\color{red}$x_\text{recurrence}$}(fxxx);
\path[arrow, color=blue, dashed](dxx-y)--node{\color{blue}$y_\text{recurrence}$}(fxxy);
\path[arrow, color=blue, dashed](dxy-y)--node{\color{blue}$y_\text{recurrence}$}(fxyy);
\path[arrow, color=blue, dashed](dyy-y)--node{\color{blue}$y_\text{recurrence}$}(fyyy);
\path[arrow, color=green](dxx-z)--node{\color{green}$z_\text{recurrence}$}(fxxz);
\path[arrow, color=green](dxy-z)--node{\color{green}$z_\text{recurrence}$}(fxyz);
\path[arrow, color=green](dyy-z)--node{\color{green}$z_\text{recurrence}$}(fyyz);
\path[arrow, color=green](dxz)--node{\color{green}$z_\text{recurrence}$}(fxzz);
\path[arrow, color=green](dyz)--node{\color{green}$z_\text{recurrence}$}(fyzz);
\path[arrow, color=green](dzz)--node{\color{green}$z_\text{recurrence}$}(fzzz);
%
% axises
\path[arrow](92mm,67mm)--node[yshift=-5mm]{$\boldsymbol{j}$}(205mm,67mm);
\path[arrow](92mm,67mm)--node[rotate=90, yshift=3mm]{$\boldsymbol{i}$}(92mm,172mm);
%
% algorithm (i major)
\node at (115mm,57.5mm) (algorithm1-i-major) {\footnotesize \textbf{Algorithm ($\boldsymbol{i}$ major)}};
\node[block, color=black, text width=27em, text badly ragged, below of=algorithm1-i-major, yshift=-63mm] %
  {\scriptsize\vspace{2em}
     $w_{\boldsymbol{i}_{\xi}}=1$\\
     $w_{\boldsymbol{i}}=1$\\
     $w_{\boldsymbol{j}_{\xi}}=0$\\
     $w_{\boldsymbol{j}}=0$\\
     \color{red}
     do $n_{\boldsymbol{j}}$ = $|\boldsymbol{j}|$, $0$, $-1$\\
       \hspace{1em}do $n'_{\boldsymbol{j}}$ = $n_{\boldsymbol{j}}$, $0$, $-1$\\
         \hspace{2em}$w_{\boldsymbol{j}_{\xi}}=w_{\boldsymbol{j}_{\xi}}+1$\\
         \hspace{2em}$w_{\boldsymbol{j}}=w_{\boldsymbol{j}}+1$\\
         \hspace{2em}$\{w_{\boldsymbol{j}_{\xi}},w_{\boldsymbol{i}}\} %
           \overset{x_\text{recurrence}}{\Rightarrow}\{w_{\boldsymbol{j}},w_{\boldsymbol{i}_{\xi}}\}'$ %
             with $\boldsymbol{i}_{x}=|\boldsymbol{i}|$ and $\boldsymbol{j}_{x}=n'_{\boldsymbol{j}}$\\
       \hspace{1em}end do\\
       \hspace{1em}$w_{\boldsymbol{j}_{\xi}}=w_{\boldsymbol{j}_{\xi}}+1$\\
     end do\\
     \color{blue}
     do $n_{\boldsymbol{i}}$ = 0, $|\boldsymbol{i}|$\\
       \hspace{1em}$w_{\boldsymbol{i}_{\xi}}=w_{\boldsymbol{i}_{\xi}}+1$\\
       \hspace{1em}$w_{\boldsymbol{j}_{\xi}}=1$\\
       \hspace{1em}$w_{\boldsymbol{j}}=0$\\
       \hspace{1em}do $n_{\boldsymbol{j}}$ = $|\boldsymbol{j}|$, $0$, $-1$\\
         \hspace{2em}do $n'_{\boldsymbol{j}}$ = $0$, $n_{\boldsymbol{j}}$\\
           \hspace{3em}$w_{\boldsymbol{j}_{\xi}}=w_{\boldsymbol{j}_{\xi}}+1$\\
           \hspace{3em}$w_{\boldsymbol{j}}=w_{\boldsymbol{j}}+1$\\
           \hspace{3em}$\{w_{\boldsymbol{j}_{\xi}},w_{\boldsymbol{i}}+n_{\boldsymbol{i}}\} %
             \overset{y_\text{recurrence}}{\Rightarrow}\{w_{\boldsymbol{j}},w_{\boldsymbol{i}_{\xi}}\}'$ %
               with $\boldsymbol{i}_{y}=n_{\boldsymbol{i}}$ and $\boldsymbol{j}_{y}=n'_{\boldsymbol{j}}$\\
         \hspace{2em}end do\\
         \hspace{2em}$w_{\boldsymbol{j}_{\xi}}=w_{\boldsymbol{j}_{\xi}}+1$\\
       \hspace{1em}end do\\
     end do\\
     \color{green}
     $w_{\boldsymbol{i}}=w_{\boldsymbol{i}}-1$\\
     do $n_{\boldsymbol{i}}$ = 0, $|\boldsymbol{i}|$\\
       \hspace{1em}do $n'_{\boldsymbol{i}}$ = $0$, $|\boldsymbol{i}|-n_{\boldsymbol{i}}$\\
         \hspace{2em}$w_{\boldsymbol{i}}=w_{\boldsymbol{i}}+1$\\
         \hspace{2em}$w_{\boldsymbol{i}_{\xi}}=w_{\boldsymbol{i}_{\xi}}+1$\\
         \hspace{2em}$w_{\boldsymbol{j}_{\xi}}=|\boldsymbol{j}|+2$\\
         \hspace{2em}$w_{\boldsymbol{j}}=0$\\
         \hspace{2em}do $n_{\boldsymbol{j}}$ = $0$, $|\boldsymbol{j}|$\\
           \hspace{3em}do $n'_{\boldsymbol{j}}$ = $n_{\boldsymbol{j}}$, $|\boldsymbol{j}|$\\
             \hspace{4em}$w_{\boldsymbol{j}_{\xi}}=w_{\boldsymbol{j}_{\xi}}+1$\\
             \hspace{4em}$w_{\boldsymbol{j}}=w_{\boldsymbol{j}}+1$\\
             \hspace{4em}$\{w_{\boldsymbol{j}_{\xi}},w_{\boldsymbol{i}}\}%
               \overset{z_\text{recurrence}}{\Rightarrow}\{w_{\boldsymbol{j}},w_{\boldsymbol{i}_{\xi}}\}'$ %
                 with $\boldsymbol{i}_{z}=n_{\boldsymbol{i}}$, and $\boldsymbol{j}_{z}=n_{\boldsymbol{j}}$\\
           \hspace{3em}end do\\
         \hspace{2em}end do\\
       \hspace{1em}end do\\
     end do};
%
% algorithm (j major)
\node at (198mm,58mm) (algorithm1-j-major) {\footnotesize\textbf{Algorithm ($\boldsymbol{j}$ major)}};
\node[block, color=black, text width=18em, text badly ragged, below of=algorithm1-j-major, yshift=-43mm] %
  {\scriptsize\vspace{2em}
     \color{black}
     $w_{\boldsymbol{j}_{\xi}}=0$\\
     $w_{\boldsymbol{j}}=0$\\
     do $n_{\boldsymbol{j}}$ = $|\boldsymbol{j}|$, $0$, $-1$\\
       \hspace{1em}do $n'_{\boldsymbol{j}}$ = $0$, $n_{\boldsymbol{j}}$\\
         \hspace{2em}$w_{\boldsymbol{j}_{\xi}}=w_{\boldsymbol{j}_{\xi}}+1$\\
         \hspace{2em}$w_{\boldsymbol{j}}=w_{\boldsymbol{j}}+1$\\
         \hspace{2em}$w_{\boldsymbol{i}}=1$\\
         \hspace{2em}$w_{\boldsymbol{i}_{\xi}}=1$\\
         \color{red}
         \hspace{2em}$\{w_{\boldsymbol{i}},w_{\boldsymbol{j}_{\xi}}\}\overset{x_\text{recurrence}}{\Rightarrow}%
           \{w_{\boldsymbol{i}_{\xi}},w_{\boldsymbol{j}}\}'$\\
           \hspace{3em}with $\boldsymbol{i}_{x}=|\boldsymbol{i}|$ and $\boldsymbol{j}_{x}=n_{\boldsymbol{j}}-n'_{\boldsymbol{j}}$\\
         \color{blue}
         \hspace{2em}do $n_{\boldsymbol{i}}$ = 0, $|\boldsymbol{i}|$\\
           \hspace{3em}$w_{\boldsymbol{i}_{\xi}}=w_{\boldsymbol{i}_{\xi}}+1$\\
           \hspace{3em}$\{w_{\boldsymbol{i}}+n_{\boldsymbol{i}},w_{\boldsymbol{j}_{\xi}}+1\}\overset{y_\text{recurrence}}{\Rightarrow}%
             \{w_{\boldsymbol{i}_{\xi}},w_{\boldsymbol{j}}\}'$\\
             \hspace{4em}with $\boldsymbol{i}_{y}=n_{\boldsymbol{i}}$ and $\boldsymbol{j}_{y}=n'_{\boldsymbol{j}}$\\
         \hspace{2em}end do\\
         \color{green}
         \hspace{2em}$w_{\boldsymbol{i}}=0$\\
         \hspace{2em}do $n_{\boldsymbol{i}}$ = 0, $|\boldsymbol{i}|$\\
           \hspace{3em}do $n'_{\boldsymbol{i}}$ = $0$, $|\boldsymbol{i}|-n_{\boldsymbol{i}}$\\
             \hspace{4em}$w_{\boldsymbol{i}}=w_{\boldsymbol{i}}+1$\\
             \hspace{4em}$w_{\boldsymbol{i}_{\xi}}=w_{\boldsymbol{i}_{\xi}}+1$\\
             \hspace{4em}$\{w_{\boldsymbol{i}},w_{\boldsymbol{j}_{\xi}}+n_{\boldsymbol{j}}+2\}\overset{z_\text{recurrence}}{\Rightarrow}%
               \{w_{\boldsymbol{i}_{\xi}},w_{\boldsymbol{j}}\}'$\\
               \hspace{5em}with $\boldsymbol{i}_{z}=n_{\boldsymbol{i}}$ and $\boldsymbol{j}_{z}=|\boldsymbol{j}|-n_{\boldsymbol{j}}$\\
           \hspace{3em}end do\\
         \hspace{2em}end do\\
       \color{black}
       \hspace{1em}end do\\
       \hspace{1em}$w_{\boldsymbol{j}_{\xi}}=w_{\boldsymbol{j}_{\xi}}+1$\\
     end do};

\end{tikzpicture}

\end{document}
